<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>PARK</title>
    <meta name="description" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Codeply">
    <link rel="stylesheet" href="./css/bootstrap.min.css" />
    <link rel="stylesheet" href="./css/animate.min.css" />
    
    <link rel="stylesheet" href="./css/styles.css" />
    <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
    <script src="https://cdn.webrtc-experiment.com/gif-recorder.js"></script>
    <!-- for Edge/FF/Chrome/Opera/etc. getUserMedia support -->
    <script src="https://cdn.webrtc-experiment.com/gumadapter.js"></script>
    <script src="https://cdn.webrtc-experiment.com/DetectRTC.js"> </script>
  </head>
  <body>
    <nav id="topNav" class="navbar navbar-default-novid navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-collapse collapse" id="bs-navbar">
                <ul class="nav navbar-nav">
                	<li>
                		<a id="navtext-main" class="navbar-brand-novid page-scroll" href="https://www.machinteraction.com/parkinsons/index.html">PARK</a>
                	</li>
                    <li>
                        <a id="navtext" class="page-scroll" href="#footer">Contact</a>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a id="navtext" class="page-scroll" href="https://www.machinteraction.com/parkinsons/info.html">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <header id="first">
    	
        <div class="header-content">
            <div class="inner text-faded">
			
            	<div id="tasks">
					<div id="space-top">
						<p style="margin-bottom:80px;"></p>
					</div>
					<p style="margin-bottom:80px;"></p>
            		<div class="progress center-block" style="width:640px;">
						<div class="progress-bar" role="progressbar" aria-valuenow="57"
						aria-valuemin="0" aria-valuemax="100" style="width:57%;">57%</div>
					</div>
					<h2><span style="font-weight:bold;">Task 4: Hand Movements II<span></h2>
					<p style="margin-bottom:40px;"></p>
					<h3>Extend one arm out in front of your body with the palm down.</h3>
					<h3>Turn your palm up and down alternately 10 times, <span style="font-weight:bold;">as fast</span> and <span style="font-weight:bold;">as fully</span> as possible.</h3>
					<h3>Do this task twice, once for each hand.</h3>
				</div>
				
				<div id="space" style="display:none;">
					<p style="margin-bottom:480px;"></p>
				</div>
				<div class="buttons">
					<input type="button" class="btn yes-btn btn-xl" data-wow-duration="2s" data-wow-delay="0.2s" style="margin-top:50px;" value="Play Video" id="vid_button"/>
				</div>			
            	<button id="start_button" class="btn yes-btn btn-xl" onclick="recordVideo()" style="margin-top:150px; display:none;">Start Recording</button>
				<h3 id="wait" style="color:#000; display:none;">Please wait until the video is loaded before moving on.</h3>
				<p style="margin-bottom:250px;"></p>
			</div>
        </div>
		<div id="task-4-vid-container" style="display:none;" >
			<iframe id="video1" class="fillWidth" src="https://www.youtube.com/embed/I9tnzjSX5O8?modestbranding=1&autohide=1&showinfo=0&controls=0&rel=0&enablejsapi=1" frameborder="0"></iframe>
						
		</div>
        <div id="videoParent">
			<video id="video-background" class="fillWidth" muted></video>
		</div>
    </header>

    <footer id="footer">
        <div class="container-fluid">
            <div class="row">
               
                <div class="col-xs-6 col-sm-3 column">
                    <h4>About</h4>
                    <ul class="list-unstyled">
                        <li>Contact Us</li>
                        <li><a href="mailto:parktoolhelp@gmail.com">parktoolhelp@gmail.com</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 column">
                    <h4>Stay Posted for Future Updates</h4>
                    <iframe name="inv" style="display:none;"></iframe>
                    <form id="subscribe-form" action="submit_email_updates.php" method="post" target="inv">
                        <div class="form-group">
                          <input type="text" id="email-text" name="email" class="form-control" placeholder="Tell us your email">
                        </div>
                    </form>
                    <p id="email-invalid" style="color:red; display:none;">Error: invalid email</p>
                    <div class="form-group">
                          <button class="btn btn-default" onclick="submitEmailUpdates()" type="button">Subscribe for updates</button>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-3 text-right" style="margin-left:200px;margin-top:10px;">
                    <ul class="list-inline">
                      <li><a rel="nofollow" href="https://www.machinteraction.com/parkinsons/info.html"><img width="150" src="./img/rochci.png"></a></li>
                    </ul>
                </div>
            </div>
            <br/>
        </div>
    </footer>
    <div id="alertModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
        	<div class="modal-body">
        		<h2 class="text-center">Thank you!</h2>
        		<p class="text-center">Your email has been recorded.</p>
        		<p class="text-center">For future updates on this project, you will be notified.</p>
        		
        		<br/>
        		<button class="btn btn-primary-second btn-lg center-block" data-dismiss="modal" aria-hidden="true">OK <i class="ion-android-close"></i></button>
        	</div>
        </div>
        </div>
    </div>
    <!--scripts loaded here -->
    <script src="./js/jquery.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src="./js/jquery.easing.min.js"></script>
    <script src="./js/wow.js"></script>
    <script src="./js/scripts.js"></script>
    
    <script>
	function submitEmailUpdates(){
		if($('#email-text').val().length > 0){
			var re = /\S+@\S+\.\S+/;
			if(re.test($('#email-text').val()) == true){
				$('#email-invalid').css('display', 'none');
				$('#subscribe-form').submit();
				$('#alertModal').modal('show');
				$('#email-text').val('');
			}
			else{
				$('#email-invalid').css('display', 'inline-block');
			}
		}
	}
    </script>
    
   <script>
			
            (function() {
                var params = {},
                    r = /([^&=]+)=?([^&]*)/g;
                function d(s) {
                    return decodeURIComponent(s.replace(/\+/g, ' '));
                }
                var match, search = window.location.search;
                while (match = r.exec(search.substring(1))) {
                    params[d(match[1])] = d(match[2]);
                    if(d(match[2]) === 'true' || d(match[2]) === 'false') {
                        params[d(match[1])] = d(match[2]) === 'true' ? true : false;
                    }
                }
                window.params = params;
            })();
            function addStreamStopListener(stream, callback) {
                var streamEndedEvent = 'ended';
                if ('oninactive' in stream) {
                    streamEndedEvent = 'inactive';
                }
                stream.addEventListener(streamEndedEvent, function() {
                    callback();
                    callback = function() {};
                }, false);
                stream.getAudioTracks().forEach(function(track) {
                    track.addEventListener(streamEndedEvent, function() {
                        callback();
                        callback = function() {};
                    }, false);
                });
                stream.getVideoTracks().forEach(function(track) {
                    track.addEventListener(streamEndedEvent, function() {
                        callback();
                        callback = function() {};
                    }, false);
                });
            }
        </script>
   <script>
            var recordingPlayer = document.querySelector('#video-background');
            //var mediaContainerFormat = document.querySelector('.media-container-format');
			var recordingMedia = 'record-audio-plus-video';
			var mediaContainerFormat = 'vp8';
			
            var mimeType = 'video/webm';
            var fileExtension = 'webm';
            var type = 'video';
            var recorderType;
            var defaultWidth=420;
            var defaultHeight;
			
			var firstTask = true;
			var userID = "";
            var btnStartRecording = document.querySelector('#start_button');
			var vidContainer = document.querySelector('#video-container');
			var next = false;
			var waitText = document.getElementById("wait");
			
            window.onbeforeunload = function() {
                btnStartRecording.disabled = false;
                //recordingMedia.disabled = false;
				//mediaContainerFormat.disabled = false;
            };
            function recordVideo() {
                var button = btnStartRecording;
				var vidtext = document.querySelector('#tasks');
				vidtext.style.display = 'none';
				$('#space').css('display', 'inline-block');
				if(button.innerHTML === 'Stop Recording') {
                   // btnPauseRecording.style.display = 'none';
					
                    button.disabled = true;
                    button.disableStateWaiting = true;
                    setTimeout(function() {
                        button.disabled = false;
                        button.disableStateWaiting = false;
                    }, 2000);
					
                    function stopStream() {
                        if(button.stream && button.stream.stop) {
                            button.stream.stop();
                            button.stream = null;
                        }
                        if(button.stream instanceof Array) {
                            button.stream.forEach(function(stream) {
                                stream.stop();
                            });
                            button.stream = null;
                        }
                        videoBitsPerSecond = null;
                    }
                    if(button.recordRTC) {
                        if(button.recordRTC.length) {
                            button.recordRTC[0].stopRecording(function(url) {
                                if(!button.recordRTC[1]) {
                                    button.recordingEndedCallback(url);
                                    stopStream();
									
									//if(button.innerHTML === 'Stop Recording'){
										saveToDiskOrOpenNewTab(button.recordRTC[0]);
									//vidContainer.style.display = 'none';
									
									//}
                                    return;
                                }
                                button.recordRTC[1].stopRecording(function(url) {
                                    button.recordingEndedCallback(url);
                                    stopStream();
                                });
                            });
                        }
                        else {
                            button.recordRTC.stopRecording(function(url) {
                                button.recordingEndedCallback(url);
                                stopStream();
								
							//	if(button.innerHTML === 'Stop Recording'){
									saveToDiskOrOpenNewTab(button.recordRTC);
									//vidContainer.style.display = 'none';
								//}
                            });
                        }
                    }
					
					button.innerHTML = 'Start Recording';
					//vidContainer.style.display = 'none';
					proceed();
					
                    return;
                }
				
                button.disabled = true;
						
                var commonConfig = {
                    onMediaCaptured: function(stream) {
                        button.stream = stream;
                        if(button.mediaCapturedCallback) {
                            button.mediaCapturedCallback();
                        }
						button.innerHTML = 'Stop Recording';
						
                        button.disabled = false;
                    },
                    onMediaStopped: function() {
                        
						button.innerHTML = 'Start Recording';
						
                        if(!button.disableStateWaiting) {
                            button.disabled = false;
                        }
                    },
                    onMediaCapturingFailed: function(error) {
                        if(error.name === 'PermissionDeniedError' && !!navigator.mozGetUserMedia) {
                            InstallTrigger.install({
                                'Foo': {
                                    // URL: 'https://addons.mozilla.org/en-US/firefox/addon/enable-screen-capturing/',
                                    URL: 'https://addons.cdn.mozilla.net/user-media/addons/655146/enable_screen_capturing_in_firefox-1.1.001-fx.xpi?filehash=sha256%3Acb13851aaca148fcbd6672fc2dddfb9653c52a529588fb27ad018e834fbb3099',
                                    toString: function() {
                                        return this.URL;
                                    }
                                }
                            });
                        }
                        commonConfig.onMediaStopped();
                    }
                };
			   ////VP8 IS WHAT WE'RE USING
                if(mediaContainerFormat === 'vp8') {
                    mimeType = 'video/webm\;codecs=vp8';
                    fileExtension = 'webm';
                    recorderType = null;
                    type = 'video';
                }
                if(recordingMedia === 'record-audio-plus-video') {
                    captureAudioPlusVideo(commonConfig);
                    button.mediaCapturedCallback = function() {
                        if(typeof MediaRecorder === 'undefined') { // opera or chrome etc.
                            button.recordRTC = [];
                            if(!params.bufferSize) {
                                // it fixes audio issues whilst recording 720p
                                params.bufferSize = 16384;
                            }
                            var options = {
                                type: 'audio', // hard-code to set "audio"
                                leftChannel: params.leftChannel || false,
                                disableLogs: params.disableLogs || false,
                                video: recordingPlayer
                            };
                            if(params.sampleRate) {
                                options.sampleRate = parseInt(params.sampleRate);
                            }
                            if(params.bufferSize) {
                                options.bufferSize = parseInt(params.bufferSize);
                            }
                            if(params.frameInterval) {
                                options.frameInterval = parseInt(params.frameInterval);
                            }
                            if(recorderType) {
                                options.recorderType = recorderType;
                            }
                            if(videoBitsPerSecond) {
                                options.videoBitsPerSecond = videoBitsPerSecond;
                            }
                            var audioRecorder = RecordRTC(button.stream, options);
                            options.type = type;
                            var videoRecorder = RecordRTC(button.stream, options);
                            // to sync audio/video playbacks in browser!
                            videoRecorder.initRecorder(function() {
                                audioRecorder.initRecorder(function() {
                                    audioRecorder.startRecording();
                                    videoRecorder.startRecording();
                                    //btnPauseRecording.style.display = '';
                                });
                            });
                            button.recordRTC.push(audioRecorder, videoRecorder);
                            button.recordingEndedCallback = function() {
                                var audio = new Audio();
                                audio.src = audioRecorder.toURL();
                                //audio.controls = true;
                                audio.autoplay = true;
                                recordingPlayer.parentNode.appendChild(document.createElement('hr'));
                                recordingPlayer.parentNode.appendChild(audio);
                                if(audio.paused) audio.play();
                            };
                            return;
                        }
                        var options = {
                            type: type,
                            mimeType: mimeType,
                            disableLogs: params.disableLogs || false,
                            getNativeBlob: false, // enable it for longer recordings
                            video: recordingPlayer
                        };
                        if(recorderType) {
                            options.recorderType = recorderType;
                            if(recorderType == WhammyRecorder || recorderType == GifRecorder) {
                                options.canvas = options.video = {
                                    width: 320,
                                    height: 240
									//width: defaultWidth || 320,
                                    //height: defaultHeight || 240
                                };
                            }
                        }
                        if(videoBitsPerSecond) {
                            options.videoBitsPerSecond = videoBitsPerSecond;
                        }
                        button.recordRTC = RecordRTC(button.stream, options);
                        button.recordingEndedCallback = function(url) {
                            //setVideoURL(url);
                        };
                        button.recordRTC.startRecording();
                    };
                }
            }
            function captureVideo(config) {
                captureUserMedia({video: true}, function(videoStream) {
                    config.onMediaCaptured(videoStream);
                    addStreamStopListener(videoStream, function() {
                        config.onMediaStopped();
                    });
                }, function(error) {
                    config.onMediaCapturingFailed(error);
                });
            }
            function captureAudio(config) {
                captureUserMedia({audio: true}, function(audioStream) {
                    config.onMediaCaptured(audioStream);
                    addStreamStopListener(audioStream, function() {
                        config.onMediaStopped();
                    });
                }, function(error) {
                    config.onMediaCapturingFailed(error);
                });
            }
            function captureAudioPlusVideo(config) {
                captureUserMedia({video: true, audio: false}, function(audioVideoStream) {
                    config.onMediaCaptured(audioVideoStream);
                    if(audioVideoStream instanceof Array) {
                        audioVideoStream.forEach(function(stream) {
                            addStreamStopListener(stream, function() {
                                config.onMediaStopped();
                            });
                        });
                        return;
                    }
                    addStreamStopListener(audioVideoStream, function() {
                        config.onMediaStopped();
                    });
                }, function(error) {
                    config.onMediaCapturingFailed(error);
                });
            }
            function captureScreen(config) {
                window.getScreenId = function(chromeMediaSource, chromeMediaSourceId) {
                    var screenConstraints = {
                        audio: false,
                        video: {
                            mandatory: {
                                chromeMediaSourceId: chromeMediaSourceId,
                                chromeMediaSource: chromeMediaSource
                            }
                        }
                    };
                    if(webrtcDetectedBrowser == 'firefox') {
                        screenConstraints = {
                            video: {
                                mediaSource: 'window'
                            }
                        }
                    }
                    captureUserMedia(screenConstraints, function(screenStream) {
                        config.onMediaCaptured(screenStream);
                        addStreamStopListener(screenStream, function() {
                            // config.onMediaStopped();
                            btnStartRecording.onclick();
                        });
                    }, function(error) {
                        config.onMediaCapturingFailed(error);
                    });
                };
                if(webrtcDetectedBrowser == 'firefox') {
                    window.getScreenId();
                }
                window.postMessage('get-sourceId', '*');
            }
            function captureAudioPlusScreen(config) {
                window.getScreenId = function(chromeMediaSource, chromeMediaSourceId) {
                    var screenConstraints = {
                        audio: false,
                        video: {
                            mandatory: {
                                chromeMediaSourceId: chromeMediaSourceId,
                                chromeMediaSource: chromeMediaSource
                            }
                        }
                    };
                    if(webrtcDetectedBrowser == 'firefox') {
                        screenConstraints = {
                            video: {
                                mediaSource: 'window',
                            },
                            audio: true
                        }
                    }
                    captureUserMedia(screenConstraints, function(screenStream) {
                        if(webrtcDetectedBrowser == 'firefox') {
                            config.onMediaCaptured(screenStream);
                            addStreamStopListener(screenStream, function() {
                                config.onMediaStopped();
                            });
                            return;
                        }
                        captureUserMedia({audio: true}, function(audioStream) {
                            // merge audio tracks into the screen
                            screenStream.addTrack(audioStream.getAudioTracks()[0]);
                            config.onMediaCaptured(screenStream);
                            addStreamStopListener(screenStream, function() {
                                config.onMediaStopped();
                            });
                        }, function(error) {
                            config.onMediaCapturingFailed(error);
                        });
                    }, function(error) {
                        config.onMediaCapturingFailed(error);
                    });
                };
                if(webrtcDetectedBrowser == 'firefox') {
                    window.getScreenId();
                }
                window.postMessage('get-sourceId', '*');
            }
            var videoBitsPerSecond;
            function setVideoBitrates() {
               // var select = document.querySelector('.media-bitrates');
               // var value = select.value;
				var value = 'default';
                if(value == 'default') {
                    videoBitsPerSecond = null;
                    return;
                }
                videoBitsPerSecond = parseInt(value);
            }
            function getFrameRates(mediaConstraints) {
                if(!mediaConstraints.video) {
                    return mediaConstraints;
                }
                //var select = document.querySelector('.media-framerates');
               // var value = select.value;
				var value = 'default';
                if(value == 'default') {
                    return mediaConstraints;
                }
                value = parseInt(value);
                if(webrtcDetectedBrowser == 'firefox') {
                    mediaConstraints.video.frameRate = value;
                    return mediaConstraints;
                }
                if(!mediaConstraints.video.mandatory) {
                    mediaConstraints.video.mandatory = {};
                    mediaConstraints.video.optional = [];
                }
				var isScreen = recordingMedia.toString().toLowerCase().indexOf('screen') != -1;
                //var isScreen = recordingMedia.value.toString().toLowerCase().indexOf('screen') != -1;
                if(isScreen) {
                    mediaConstraints.video.mandatory.maxFrameRate = value;
                }
                else {
                    mediaConstraints.video.mandatory.minFrameRate = value;
                }
                return mediaConstraints;
            }
           // function setGetFromLocalStorage(selectors) {
           //     selectors.forEach(function(selector) {
           //         var storageItem = selector.replace(/\.|#/g, '');
           //         if(localStorage.getItem(storageItem)) {
           //             document.querySelector(selector).value = localStorage.getItem(storageItem);
           //         }
           //         addEventListenerToUploadLocalStorageItem(selector, ['change', 'blur'], function() {
           //             localStorage.setItem(storageItem, document.querySelector(selector).value);
           //         });
           //     });
           // }
            function addEventListenerToUploadLocalStorageItem(selector, arr, callback) {
                arr.forEach(function(event) {
                    document.querySelector(selector).addEventListener(event, callback, false);
                });
            }
          //  setGetFromLocalStorage(['.media-resolutions', '.media-framerates', '.media-bitrates', '.recording-media', '.media-container-format']);
            function getVideoResolutions(mediaConstraints) {
                if(!mediaConstraints.video) {
                    return mediaConstraints;
                }
               // var select = document.querySelector('.media-resolutions');
               // var value = select.value;
				var value = 'default';
                if(value == 'default') {
                    return mediaConstraints;
                }
                value = value.split('x');
                if(value.length != 2) {
                    return mediaConstraints;
                }
                defaultWidth = parseInt(value[0]);
                defaultHeight = parseInt(value[1]);
                if(webrtcDetectedBrowser == 'firefox') {
                    mediaConstraints.video.width = defaultWidth;
                    mediaConstraints.video.height = defaultHeight;
                    return mediaConstraints;
                }
                if(!mediaConstraints.video.mandatory) {
                    mediaConstraints.video.mandatory = {};
                    mediaConstraints.video.optional = [];
                }
				var isScreen = recordingMedia.toString().toLowerCase().indexOf('screen') != -1;
                //var isScreen = recordingMedia.value.toString().toLowerCase().indexOf('screen') != -1;
                if(isScreen) {
                    mediaConstraints.video.mandatory.maxWidth = defaultWidth;
                    mediaConstraints.video.mandatory.maxHeight = defaultHeight;
                }
                else {
                    mediaConstraints.video.mandatory.minWidth = defaultWidth;
                    mediaConstraints.video.mandatory.minHeight = defaultHeight;
                }
                return mediaConstraints;
            }
            function captureUserMedia(mediaConstraints, successCallback, errorCallback) {
                if(mediaConstraints.video == true) {
                    mediaConstraints.video = {
						mandatory:{
							maxWidth:640,
							maxHeight:500,
							minWidth:640
						}
					};
                }
                setVideoBitrates();
                mediaConstraints = getVideoResolutions(mediaConstraints);
                mediaConstraints = getFrameRates(mediaConstraints);
                var isBlackBerry = !!(/BB10|BlackBerry/i.test(navigator.userAgent || ''));
                if(isBlackBerry && !!(navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia)) {
                    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
                    navigator.getUserMedia(mediaConstraints, successCallback, errorCallback);
                    return;
                }
               // if(chkMultiStreamRecorder.checked === true) {
                //    captureAllCameras(successCallback, errorCallback);
                //    return;
               // }
                navigator.mediaDevices.getUserMedia(mediaConstraints).then(function(stream) {
                    successCallback(stream);
                    setVideoURL(stream, true);
                }).catch(function(error) {
                    if(error && error.name === 'ConstraintNotSatisfiedError') {
                        alert('Your camera or browser does NOT supports selected resolutions or frame-rates. \n\nPlease select "default" resolutions.');
                    }
                    errorCallback(error);
                });
            }
            //function setMediaContainerFormat(arrayOfOptionsSupported) {
               // var options = Array.prototype.slice.call(
               //     mediaContainerFormat.querySelectorAll('option')
              //  );
              //  var localStorageItem;
              //  if(localStorage.getItem('media-container-format')) {
               //     localStorageItem = localStorage.getItem('media-container-format');
               // }
               // var selectedItem;
               // options.forEach(function(option) {
               //     option.disabled = true;
               //     if(arrayOfOptionsSupported.indexOf(option.value) !== -1) {
               //         option.disabled = false;
               //         if(localStorageItem && arrayOfOptionsSupported.indexOf(localStorageItem) != -1) {
               //             if(option.value != localStorageItem) return;
               //             option.selected = true;
               //             selectedItem = option;
               //             return;
               //         }
               //         if(!selectedItem) {
               //             option.selected = true;
               //             selectedItem = option;
               //         }
               //     }
              //  });
           // }
            //recordingMedia.onchange = function() {
                //var options = [];
              //  if(recordingMedia.value === 'record-audio') {
               //     setMediaContainerFormat(['opus', 'pcm']);
               //     return;
              //  }
              //  setMediaContainerFormat(['vp8', 'vp9', 'h264', 'gif', 'whammy']);
          //  };
           // recordingMedia.onchange();
            if(webrtcDetectedBrowser === 'edge') {
                // webp isn't supported in Microsoft Edge
                // neither MediaRecorder API
                // so lets disable both video/screen recording options
                console.warn('Neither MediaRecorder API nor webp is supported in Microsoft Edge. You cam merely record audio.');
                //recordingMedia.innerHTML = '<option value="record-audio">Audio</option>';
                recordingMedia = 'record-audio';
				mediaContainerFormat = 'pcm';
				//setMediaContainerFormat(['pcm']);
            }
            function saveToDiskOrOpenNewTab(recordRTC) {
                
				//var ran = Math.floor(Math.random()*(100+1));
				//var ranString = ran.toString() + '-';
				//var fileName = 'Z-' + (new Date).toISOString().replace(/:|\./g, '-') + ranString + 'task4' + '.' + fileExtension;
                
				var id = sessionStorage.getItem('userID');
				userID = id + '-task4';
				var fileName = userID + '.' + fileExtension;
			    
                // upload to PHP server
				if(!recordRTC) return alert('No recording found.');
                this.disabled = true;
                var button = this;
                uploadToPHPServer(fileName, recordRTC, function(progress, fileURL) {
                    if(progress === 'ended') {
                        button.disabled = false;
                       // button.innerHTML = 'Click to download from server';
                       // button.onclick = function() {
                       //     SaveFileURLToDisk(fileURL, fileName);
                       // };
                        //setVideoURL(fileURL);
						window.location.href = "retake.html";
						waitText.style.display = 'none';
						next = true;
                        return;
                    }
                    button.innerHTML = progress;
                });
				//recordingPlayer.pause();
				recordingPlayer.removeAttribute('src');
				recordingPlayer.remove();
            }
            function uploadToPHPServer(fileName, recordRTC, callback) {
                var blob = recordRTC instanceof Blob ? recordRTC : recordRTC.getBlob();
                
                blob = new File([blob], 'RecordRTC-' + (new Date).toISOString().replace(/:|\./g, '-') + '.' + fileExtension, {
                    type: mimeType
                });
                // create FormData
                var formData = new FormData();
                formData.append('video-filename', fileName);
                formData.append('video-blob', blob);
                callback('Uploading recorded-file to server.');
				//'https://webrtcweb.com/RecordRTC/'
				
                makeXMLHttpRequest('save.php', formData, function(progress) {
                    if (progress !== 'upload-ended') {
                        callback(progress);
                        return;
                    }
                    var initialURL = 'https://www.machinteraction.com/parkinsons/openfaceUploads/';

                    callback('ended', initialURL + fileName);
                });
				
            }
            function makeXMLHttpRequest(url, data, callback) {
                var request = new XMLHttpRequest();
                request.onreadystatechange = function() {
                    if (request.readyState == 4 && request.status == 200) {
                        callback('upload-ended');
                    }
                };
                request.upload.onloadstart = function() {
                    callback('Upload started...');
                };
                request.upload.onprogress = function(event) {
                    callback('Upload Progress ' + Math.round(event.loaded / event.total * 100) + "%");
                };
                request.upload.onload = function() {
                    callback('progress-about-to-end');
                };
                request.upload.onload = function() {
                    callback('progress-ended');
                };
                request.upload.onerror = function(error) {
                    callback('Failed to upload to server');
                };
                request.upload.onabort = function(error) {
                    callback('Upload aborted.');
                };
                request.open('POST', url);
                request.send(data);
            }
            function getURL(arg) {
                var url = arg;
                if(arg instanceof Blob || arg instanceof File) {
                    url = URL.createObjectURL(arg);
                }
                if(arg instanceof RecordRTC || arg.getBlob) {
                    url = URL.createObjectURL(arg.getBlob());
                }
                if(arg instanceof MediaStream || arg.getTracks || arg.getVideoTracks) {
                    url = URL.createObjectURL(arg);
                }
                return url;
            }
            function setVideoURL(arg, forceNonImage) {
                var url = getURL(arg);
                var parentNode = recordingPlayer.parentNode;
                parentNode.removeChild(recordingPlayer);
                parentNode.innerHTML = '';
                var elem = 'video';
                if(type == 'gif' && !forceNonImage) {
                    elem = 'img';
                }
                if(type == 'audio') {
                    elem = 'audio';
                }
                recordingPlayer = document.createElement(elem);
                
                if(arg instanceof MediaStream) {
                    recordingPlayer.muted = true;
                }
				recordingPlayer.muted = true;
                recordingPlayer.addEventListener('loadedmetadata', function() {
                    if(navigator.userAgent.toLowerCase().indexOf('android') == -1) return;
                    // android
                    setTimeout(function() {
                        if(typeof recordingPlayer.play === 'function') {
                            recordingPlayer.play();
                        }
                    }, 2000);
                }, false);
                recordingPlayer.poster = '';
                recordingPlayer.src = url;
                if(typeof recordingPlayer.play === 'function') {
                    recordingPlayer.play();
                }
                recordingPlayer.addEventListener('ended', function() {
                    url = getURL(arg);
                    recordingPlayer.src = url;
                });
				recordingPlayer.width = $(window).width();
				recordingPlayer.height = $(window).height();
               // recordingPlayer.controls = true;
                parentNode.appendChild(recordingPlayer);
				
            }
        
 </script>
	 
 	<script>
 	sessionStorage.setItem('currentTask', 'task4');
 	
 	var pressRec = document.getElementById("start_button");
	var myVideo = document.getElementById('video1');
	var vidButton = document.getElementById('vid_button');
	var onVid = 1;

	function hideVideo(){
	jQuery(function($){
		onVid = 0;
		vidButton.style.display = 'none';
		$('#space').css('display', 'none');
		$('#task-4-vid-container').css('display', 'none');
		$('#space-top').css('display', 'inline-block');
		$('#start_button').css('display', 'inline-block');
		$('#tasks').css('display', 'inline-block');
	});
	}

	function proceed(){
	
		pressRec.style.display = 'none';
		waitText.style.display = 'inline-block';
	}

function nextTask(){
	
    jQuery(function($) {
	
		window.location.href = "retake.html";

  });
}

	window.onkeydown = function(e){
		if(e.keyCode === 32){
			e.preventDefault();
			if(onVid == 1){
				vidButton.click();
			}
			else if(onVid == 0){
				pressRec.click();
			}
		}
	};

	var player;
	function onYouTubePlayerAPIReady() {
		player = new YT.Player('video1', {
			events: {
			'onReady': onPlayerReady,
			'onStateChange': onPlayerStateChange
			}
		});
	}
	function onPlayerReady(event) {
		var playButton = document.getElementById("vid_button");
		playButton.addEventListener("click", function() {
    
		if (playButton.value.includes("Play Video")){
			playButton.value = "Pause Video";
			player.playVideo();
		}
		else if (playButton.value.includes("Pause Video")){
			player.pauseVideo();
			playButton.value = "Play Video";
		}
		});
	}
function onPlayerStateChange(event) {        
    if(event.data === 0) {          
        hideVideo();
    }
	else if(event.data === 1){
		$('#tasks').css('display', 'none');
		$('#space').css('display', 'inline-block');
		$('#task-4-vid-container').css('display', 'inline-block');
	}
}
// Inject YouTube API script
var tag = document.createElement('script');
tag.src = "//www.youtube.com/player_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
	</script>
 	<script>
        var chromeMediaSource = 'screen';
        window.addEventListener('message', function(message) {
            if(message.origin != 'https://www.webrtc-experiment.com') return;
            chromeMediaSource = 'desktop';
            if(typeof getScreenId == 'function' && !!message.data.sourceId) {
                getScreenId(chromeMediaSource, message.data.sourceId);
            }
        });
    </script>

  </body>
</html>